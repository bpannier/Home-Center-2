{"name":"Fritz!Box","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"-- Enable Fritz.box call monitor ones with calling: #96*5*\n\n-- Original Source (modified): https://www.siio.de/fritzbox-integration-homecenter-2/\n\nlocal thisdevice = fibaro:getSelfId();\n\nlocal callSceneNumber = 37\n\nlocal ip = fibaro:getValue(thisdevice, 'IPAddress');\nlocal port = fibaro:getValue(thisdevice, 'TCPPort');\nlocal loopCount = 0;\n\nfibaro:debug(\"Start\");\ntcpSocket = Net.FTcpSocket(ip, port);\ntcpSocket:setReadTimeout(60000); \nresult, err = tcpSocket:write(\"r\\n\");\n\nwhile (err<2) do\n  result, err = tcpSocket:read();\n  result = string.upper(result or string.char());\n\n  if(result~=\"\") then\n    fibaro:debug(result);\n    local msg={}\n    i=1\n  \n    for str in string.gmatch(result, \"([^;]+)\") do\n      msg[i] = str\n      i = i + 1\n    end\n      \n    fibaro:call(thisdevice, \"setProperty\", \"ui.Action.value\", msg[2]);\n    --fibaro:setGlobal(\"FritzBoxStatus\", msg[2])\n    --fibaro:setGlobal(\"FritzBoxTelNr\", msg[4])\n    \n    local number = msg[4]\n    local status = msg[2]\n  \n    if(msg[2]==\"CALL\") then\n      fibaro:call(thisdevice, \"setProperty\", \"ui.Number.value\", msg[6]);\n      number = msg[6]\n    end\n    \n    if(msg[2]==\"RING\") then\n      fibaro:call(thisdevice, \"setProperty\", \"ui.Number.value\", \" \" .. msg[4]);\n      --fibaro:setGlobal(\"FritzBoxTelNr\", msg[4])\n    end\n    \n    fibaro:call(thisdevice, \"setProperty\", \"ui.DateTime.value\", msg[1]);\n    fibaro:startScene(callSceneNumber, {{number = number, status = status}}) --Startet die Fritzbox-Szene zur Reduzierung der Sonos-LautstÃ¤rke\n  end\n  \n  loopCount=loopCount+1;\n  if (loopCount==60) then -- approx 1 hour\n    err=1234\n  end\nend\n\nfibaro:debug(\"Closing Connection\");\ntcpSocket:disconnect();\nfibaro:sleep(2500);\nfibaro:debug(\"Exit Code=\" .. err);\nfibaro:debug(\"Loop=\" .. loopCount);\n","ui.Action.value":"DISCONNECT","ui.DateTime.value":"23.03.18 07:17:43","ui.Number.value":" 017673146813","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"Action","name":"Action","favourite":false,"main":false}]},{"type":"label","elements":[{"id":2,"lua":false,"waitForResponse":false,"caption":"Number","name":"Number","favourite":false,"main":false}]},{"type":"label","elements":[{"id":3,"lua":false,"waitForResponse":false,"caption":"Date &amp; Time","name":"DateTime","favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}